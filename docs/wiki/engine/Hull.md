# HULL

"HULL" 是指模型或地图的"外部"皮肤/表面平面/面的边界。Half-Life 地图有 4 个 hull，一个用于视觉渲染，三个用于碰撞检测。当编译地图时出现 LEAK 错误时，会提到 hull。

*注意：在下表中，边界和大小以 X、Y 和 Z 坐标的 3D 向量表示。注意这些都不一定与地板、天花板或墙壁相关联。*

| 索引 | 最小边界 | 最大边界 | 大小 | 描述* |
| --- | --- | --- | --- | --- |
|   | (0, 0, 0) | (0, 0, 0) | 这是物理 hull，基本上是平面和刷子面。 | |
| 1 | (-16, -16, -36) | (16, 16, 36) | (32, 32, 72) | 这是限制站立玩家可去区域的 hull。基本上这个 hull 防止玩家"被埋在地板或墙中"。模型与 hull 关系不大。 |
| 2 | (-32, -32, -32) | (32, 32, 32) | (64, 64, 64) | 这个 hull 限制大型怪物如 Gargantua、Gonarch 和 Bullsquid 的移动范围。 |
| 3 | (-16, -16, -18) | (16, 16, 18) | (32, 32, 36) | 这个是为蹲着的玩家设计的。 |
| 4 | 不适用 | 不适用 | 不适用 | 这是一个虚假的 hull 错误，实际上不存在。 |

* 来源：VERC

## 机制

John Carmack 在 Quake 中引入了 BSP 格式，并使用 clip hulls 来加速碰撞检测。

一个简单的计算玩家碰撞的算法通常涉及计算平面与点（玩家实体的中心）之间的距离，然后从其中心减去玩家实体的厚度。这个计算对所有三个轴向方向的两侧都要进行，总共 6 次。

Carmack 的解决方案是在编译过程中预先计算"厚度"部分，通过将可碰撞平面向外扩展到与玩家实体中心点相同的距离，这样在游戏循环中，碰撞检测代码只需检查距离是否大于零。Hull 1 用于普通站立的玩家，Hull 3 用于蹲着的玩家。因此，就世界碰撞而言，玩家被简化为空间中的单个点。

Hulls 和 clipnodes 是紧密相关的概念，实际上 clip hulls 是由 clipnodes 组成的。

## 控制 hull 生成

现代 GoldSrc 编译器如 VHLT 提供了几种控制 hull 生成的方法。

最粗略的控制方式是完全关闭整个 hull。这可以通过向 HLBSP 传递以下参数来实现：
* `-noclip` – 完全跳过 clip 生成。地图将没有任何碰撞
* `-nohull#` (#=1…3) – 跳过从世界几何体生成指定的 hull 号

一个典型的用例是在多人游戏地图上使用 `-nohull2`，其中没有怪物（因此没有使用 Hull 2）和没有使用相同 hull 的 `func_pushable`，这可以减少大约 1/3 的 clipnode 预算。在单人游戏地图中移除 hull 2 需要更谨慎的考虑。

之后，对 hull 生成有更细粒度的按刷子、按区域或按实体的控制：
* 在刷子上使用 `NOCLIP` 纹理
* 在 `func_detail` 或刷子实体上使用 `zhlt_noclip` 键值

但是，这会跳过对*所有*碰撞 hull 的 clip 生成。

第三，有 CLIP 和相关工具纹理系列，它指示在一些或所有碰撞 hull 上生成 clipnodes。如果使用之前的任何方法跳过从世界几何体构建 clipnodes，可以使用这些 clip 刷子手动添加回碰撞。这些纹理包括：
* `CLIP` – 所有三个碰撞 hull
* `CLIPHULL#` (#=1…3) – hull #

最后但同样重要的是，一个非常强大的实体叫做 info_hullshape，可以为特定实体或整个地图自定义 hull 的大小，上表中的固定值不再适用。

虽然上述方法可以安全地用于自定义 clipnode 生成，使用默认 hull 大小作为基础，但修改 hull 大小本身会有影响。例如，许多 NPC 使用简单的碰撞检测方法，因为它们不像玩家那样灵活，所以减小 hull 大小可能不会使 NPC 神奇地适应比原始 hull 形状更窄的缝隙。

[来源：TWHL Wiki](https://twhl.info/wiki/page/HULL_#)
