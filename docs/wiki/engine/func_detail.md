# func_detail 详解

## 什么是func_detail？

func_detail是VHLT（Valve Half-Life Tools）对BSP面分割问题的解决方案。在Half-Life地图制作中，func_detail扮演着重要角色，它是世界几何体（worldspawn）和刷子实体（brush entities）之间的中间层。

当你在编辑器中创建一个房间时，该房间是从"虚空"中挖空的。BSP和CSG的理论基础是你对一个体积进行添加或减法操作，没有中间状态。这在理论上听起来不错，但会导致非常高的多边形数量，有时还会因为编译工具代码问题（如hlrad）而产生光照错误。

func_detail不是常规实体，它只是"标记"一个刷子供编译工具使用。在默认设置下，func_detail刷子的行为与世界刷子完全相同，但它不会切割世界面（节省多边形），并且在VIS处理过程中被忽略（缩短编译时间）。

## 详细属性解释

### 细节等级 (zhlt_detaillevel)

细节等级指定刷子操作的"层级"：

- **等级0**：与世界相同，等级0的func_detail将完全像世界刷子一样行为，它们会切割世界几何体，VIS会被它们阻挡。
- **等级1**（默认）：不会切割世界几何体，VIS忽略它们。等级0刷子（世界几何体）会切割它们，因此玩家永远看不到的面会被剔除。
- **等级2**：与等级1相同，但所有低于它的层级都会切割它。这种模式一直延续。
  - 等级0和1的刷子会切割等级2
  - 等级2切割等级3
  - 等级3被等级0、1和2切割

这允许高度自定义和自动优化。例如：
- 桌子可以是等级1
- 桌上的纸可以是等级2
- 纸上的电话可以是等级3

如果你使用过Photoshop或其他图像编辑器，你已经了解这个工作原理（类似图层）。

### 降低等级以切割其他物体 (zhlt_chopdown)

允许刷子降低其细节等级（不低于当前等级）以切割其他刷子。

这主要用于使细节刷子切割世界几何体。例如，一个细节等级设为1且此值设为1的细节刷子将切割/剔除世界刷子几何体，但仍不受VIS影响。当你有一个薄刷子且光线从一侧穿透到另一侧时，这很有用。

### 提高等级以被切割 (zhlt_chopup)

与上一个功能相反，几乎没有用处。

### 面重叠时的优先级 (zhlt_coplanarpriority)

非常有用的功能，本质上是另一种细节等级，但用于重叠的刷子面。当你在细节刷子中嵌入灯光，但希望灯光在地图编译时具有优先级，而不必切割嵌入灯光的刷子时，这很有用。

据我所知，这对世界刷子不起作用。

### 剪裁外壳的细节等级 (zhlt_clipnodedetaillevel)

与细节等级相同，但用于剪裁节点。除非处理非常复杂的几何体，否则没有用处，可能只在出现bug时有用。

### 可通过 (zhlt_noclip)

顾名思义，使刷子对除子弹或投射物外的一切可通过。是func_illusionary的进阶版本。

注意：zhlt_noclip是一个通用键，可用于所有刷子类型，建议添加到你的FGD中。

值得注意的是：与HL2不同，子弹撞击和贴花仍会出现在可通过的刷子上。

## 使用建议

- func_detail用于帮助你解决复杂情况，任何复杂几何体都应转换为细节
- 房间在没有实体的情况下应接近立方体形状
- 虽然现代电脑可以轻松运行HL1最复杂的地图，但优化地图仍然是个好主意
- 最大的变化是编译时间，优化的地图编译速度比未优化的快得多

## VHLT额外提示

- 这些工具基本上是完美的，你不必担心许多经典bug
- 在一个面上使用CLIP纹理的刷子现在将像剪裁刷子一样工作，而不是产生混合面内容错误。这对栏杆特别有用
- 由于旧版qrad的缺陷，最终光照图被应用了两次，使亮度翻倍。VHLT修复了这个问题，但默认的-scale值被提高到2以兼容旧地图。如果你从头开始制作新地图，建议在hlrad的命令行中使用-scale 1.0以获得最正确的光照
- 软天空效果不佳，应在hlrad的命令行中保持-softsky为0（它试图软化light_environment阴影，但反而会破坏效果）
- 使用hlrad的-sky编译命令来缩放由light_environment生成的环境光照，默认值为1.0
- 如果你的地图在hlrad中计算visleafs需要很长时间，考虑在命令行中使用"-vismatrix off"来禁用它（不适用于最终编译）
